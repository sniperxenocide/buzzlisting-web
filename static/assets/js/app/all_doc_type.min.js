"use strict";var init=function(){var e=location.host+"/api/v1/dms/",t="http://"+e+"categorization/",a=("http://"+location.host+"dms/categorization/root/",null),d=function(e,t){var a=e.find("tbody tr.selected");a.length>0&&a.not(t).removeClass("selected")},l=new Date;console.log(l),$("#date_box").datetimepicker({format:"YYYY-MM-DD hh:mm",useCurrent:!1,defaultDate:moment().add(50,"years"),minDate:moment()}),$("#add_parent_new_cat_doc").on("hidden.bs.modal",function(){$(".help-block").empty(),$(".form-group").removeClass("has-error"),$(this).removeData("bs.modal")}),$("#add_new_metafield").on("hidden.bs.modal",function(){$(".help-block").empty(),$(".form-group").removeClass("has-error"),$(this).removeData("bs.modal")}),$("#add_new_cat_doc").on("hidden.bs.modal",function(){$(".help-block").empty(),$(".form-group").removeClass("has-error"),$(this).removeData("bs.modal")}),$("#update_metafield_modal").on("hidden.bs.modal",function(){$(".help-block").empty(),$(".form-group").removeClass("has-error"),$(this).removeData("bs.modal")}),$("#update_parent_new_cat_doc").on("hidden.bs.modal",function(){$(".help-block").empty(),$(".form-group").removeClass("has-error"),$(this).removeData("bs.modal")}),$(document).on("click","#all_doc_list tbody tr",function(e){e.stopPropagation();var t=$(this),a=new Function("return"+$(t).data("info"))(),l=a.self;"meta"==$(this).data("type")&&$("#update_btn, #delete_btn").removeAttr("disabled").data("type","meta"),$("#update_btn, #delete_btn").removeAttr("disabled").data("self",l),t.addClass("selected"),d($("#all_doc_list"),t)});var r=$("#all_doc_list");$.ajax({url:t+"root/",method:"GET",success:function(e){r.find("tbody").html(""),$.each(e,function(e,t){t.root=null==t.parent?"Yes":"No",t.type="cat"==t.type?'<i class="zmdi zmdi-folder"></i> Category':'<i class="zmdi zmdi-file"></i> Document',t.published=0==t.published?"Not Published":"Published";var a='<tr class="clickie" data-info="{parent:'+t.parent+",self:"+t.id+'}"><td>'+t.name+"</td><td>"+t.type+"</td><td>"+t.published+"</td></tr>";r.find("tbody").append(a)})}}),$(document).on("dblclick","#all_doc_list tbody tr.clickie",function(){var e=$(this),d=new Function("return"+$(e).data("info"))();a=d.parent,$.ajax({url:t+"category/"+d.self,method:"GET",success:function(e){r.find("tbody").html("");var l=$("#add_btn");l.data("parent",a),l.data("type",e.type),l.data("url_id",e.id),$("#update_btn, #delete_btn").attr("disabled","disabled"),$("#all_doc_list thead tr .back_button_container").html('<button id="back_button" data-href="'+e.id+'" class="btn bgm-cyan waves-effect"><i class="zmdi zmdi-arrow-back"></i></button>'),"cat"==e.type.toLowerCase()?($(r.find("thead tr th")[0]).attr("colspan",3),e.children.length>0&&!function(){var t="'"+e.name+"'";$.each(e.children,function(e,a){a.type="cat"==a.type.toLowerCase()?'<i class="zmdi zmdi-folder"></i> Category':'<i class="zmdi zmdi-file"></i> Document',a.published=0==a.published?"Not Published":"Published";var d='<tr class="clickie" data-info="{parent:'+t+",self:"+a.id+'}"><td>'+a.name+"</td><td>"+a.type+"</td><td>"+a.published+"</td></tr>";r.find("tbody").append(d);var l="<td>Name</td><td>Type</td><td>Published</td>"+$(r.find("thead tr")[1]).html(l)})}()):"doc"==e.type.toLowerCase()&&$.ajax({url:t+"metafield/?doc_id="+d.self,method:"GET",success:function(e){e.length>0&&(console.log(e),$.each(e,function(e,t){var a=0==t.required?"No":"Yes",d=void 0;d=0==t.data_type?"String":1==t.data_type?"Integer":2==t.data_type?"TextArea":3==t.data_type?"DropDown":4==t.data_type?"Date":5==t.data_type?"Float":"String",$(r.find("thead tr th")[0]).attr("colspan",4);var l="<td>Title</td><td>Data Type</td><td>Default Value</td><td>Required</td>";$(r.find("thead tr")[1]).html(l).css({"font-weight":500,color:"#333","text-transform":"uppercase"});var o='<tr class="clickie" data-type="meta" data-info="{self:'+t.id+'}"><td>'+t.title+"</td><td>"+d+"</td><td>"+t.default_text+"</td><td>"+a+"</td></tr>";r.find("tbody").append(o)}))}})}})}),$(document).on("click","#back_button",function(){var e=$(this),a=$(e).data("href");$.ajax({url:t+"siblings/"+a,method:"GET",success:function(e){r.find("tbody").html(""),$("#update_btn, #delete_btn").attr("disabled","disabled"),$("#add_btn").data("type","cat"),$("#update_btn").data("type","cat"),$("#delete_btn").data("type","cat"),$(r.find("thead tr th")[0]).attr("colspan",3),$(r.find("thead tr")[1]).css({"font-weight":500,color:"#333","text-transform":"uppercase"}),null!=e.parent?($("#add_btn").data("url_id",e.parent),$("#all_doc_list thead tr .back_button_container").html('<button id="back_button" data-href="'+e.parent+'" class="btn bgm-cyan waves-effect"><i class="zmdi zmdi-arrow-back"></i></button>')):($("#add_btn").data("url_id","undefined"),$("#all_doc_list thead tr .back_button_container").html("")),e.siblings.length>0&&!function(){var t="<td>Name</td><td>Type</td><td>Published</td>";$(r.find("thead tr")[1]).html(t);var a="'"+e.parent+"'";$.each(e.siblings,function(e,t){t.type="cat"==t.type.toLowerCase()?'<i class="zmdi zmdi-folder"></i> Category':'<i class="zmdi zmdi-file"></i> Document',t.published=0==t.published?"Not Published":"Published";var d='<tr class="clickie" data-info="{parent:'+a+",self:"+t.id+'}"><td>'+t.name+"</td><td>"+t.type+"</td><td>"+t.published+"</td></tr>";r.find("tbody").append(d)})}()}})}),$("#add_btn").on("click",function(){$("#name").find("input:text").val(""),$("#name").removeClass("fg-toggled"),$("#add_title").find("input:text").val(""),$("#add_title").removeClass("fg-toggled"),$("#add_default_text").find("input:text").val(""),$("#add_default_text").removeClass("fg-toggled"),$("#p_name").find("input:text").val(""),$("#p_name").removeClass("fg-toggled"),$("#update_title").find("input:text").val(""),$("#update_title").removeClass("fg-toggled"),$("#update_default_text").find("input:text").val(""),$("#update_default_text").removeClass("fg-toggled");var e=($(this).data("parent"),$(this).data("type"),$(this).data("url_id"));void 0===$(this).data("parent")||"undefined"==$(this).data("url_id")?($("#add_parent_new_cat_doc").modal().show(),$("#parent_cat_doc_field").selectpicker("refresh"),$("#parent_cat_doc_field").selectpicker("val",["cat"])):"cat"==$(this).data("type")?$.ajax({url:t+"category/"+e,method:"GET",success:function(e){var t="<option value="+e.id+">"+e.name+"</option>";$("#select_parent").empty().append(t),$("#add_new_cat_doc").modal().show(),$("#cat_doc_field").selectpicker("refresh"),$("#cat_doc_field").selectpicker("val",["cat"])}}):"doc"==$(this).data("type")?$.ajax({url:t+"category/"+e,method:"GET",success:function(e){var t="<option value="+e.id+">"+e.name+"</option>",a='<label class="control-label">Default Text</label><textarea class="form-control auto-size" name="default_text" data-parsley-trigger="change" data-parsley-pattern="^[a-zA-Z0-9_.\r ]{2,250}$" data-parsley-error-message="Value should contain only Alphanumeric and (._) values, length should be 2-250 characters"></textarea>',d='<label class="control-label">Dropdown Value</label><textarea class="form-control auto-size" name="default_text" data-parsley-trigger="change" data-parsley-pattern="^[a-zA-Z0-9_.\r ]{2,250}$" data-parsley-error-message="Value should contain only Alphanumeric and (._) values, length should be 2-250 characters"></textarea>',l='<label class="control-label">Default Text</label><input type="text" data-parsley-trigger="change" data-parsley-pattern="^[a-zA-Z0-9_. ]{2,50}$" data-parsley-error-message="Value should contain only Alphanumeric and (._) values, length should be 2-50 characters" class="form-control" name="default_text" value="">',r='<label class="control-label">Put Integer Value</label><input type="text" data-parsley-trigger="change" data-parsley-type="integer" data-parsley-error-message="Value should contain only Integer value" class="form-control" name="default_text">',o='<label class="control-label">Decimal Value</label><input type="text" data-parsley-trigger="change" data-parsley-type="number" data-parsley-error-message="Value should contain only Decimal values" class="form-control" name="default_text" value="">',n='<label class="control-label">Date</label><input type="text" class="form-control date-time-picker" id="date_box" name="default_text">';$("#doc").empty().append(t),$("#add_new_metafield").modal().show(),$("#add_meta_type").selectpicker("refresh"),$("#add_meta_type").selectpicker("val",0),$("#meta_order").selectpicker("refresh"),$("#meta_order").selectpicker("val",1),$("#required").selectpicker("refresh"),$("#required").selectpicker("val",0),$("#add_meta_type").on("change",function(){0==this.value&&$("#add_default_text").empty().append(l),3==this.value&&$("#add_default_text").empty().append(d),2==this.value&&$("#add_default_text").empty().append(a),1==this.value&&$("#add_default_text").empty().append(r),4==this.value&&($("#add_default_text").empty().append(n),$("#date_box").datetimepicker({format:"YYYY-MM-DD",useCurrent:!1})),5==this.value&&$("#add_default_text").empty().append(o)}),$("#cat_doc_field").selectpicker("refresh")}}):null===$(this).data("type")?($("#add_new_cat_doc").modal().show(),$("#cat_doc_field").selectpicker("refresh")):"undefined"==$(this).data("url_id")});var o="/api/v1/dms/categorization/root/",n=$("#add_parent_new_cat_doc_form"),s=$("#add_parent_new_cat_doc");n.submit(function(e){e.preventDefault();var t=new FormData($(this)[0]),a=n.parsley();if(a.validate(),a.isValid())return $.ajax({type:"post",url:o,data:t,processData:!1,contentType:!1,success:function(e){e.type="cat"==e.type.toLowerCase()?'<i class="zmdi zmdi-folder"></i> Category':'<i class="zmdi zmdi-file"></i> Document',e.published=0==e.published?"Not Published":"Published";var t='<tr class="clickie" data-info="{parent:'+e.parent+",self:"+e.id+'}"><td>'+e.name+"</td><td>"+e.type+"</td><td>"+e.published+"</td></tr>";r.find("tbody").append(t),s.modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove(),notify("Congratulations!!! ",e.type+" Added Successfully "," ","success")},error:function(e){var t=e.responseText;$.each(JSON.parse(t),function(e,t){var a=e+": "+t;notify("",a,"","danger")})}}),!1});var i="/api/v1/dms/categorization/category/",p=$("#add_new_cat_doc_form"),c=$("#add_new_cat_doc");p.submit(function(e){e.preventDefault();var t=new FormData($(this)[0]),a=p.parsley();if(a.validate(),a.isValid())return $.ajax({type:"post",url:i,data:t,processData:!1,contentType:!1,success:function(e){e.type="cat"==e.type.toLowerCase()?'<i class="zmdi zmdi-folder"></i> Category':'<i class="zmdi zmdi-file"></i> Document',e.published=0==e.published?"Not Published":"Published";var t='<tr class="clickie" data-info="{parent:'+e.parent+",self:"+e.id+'}"><td>'+e.name+"</td><td>"+e.type+"</td><td>"+e.published+"</td></tr>";r.find("tbody").append(t),c.modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove(),notify("Congratulations!!! ",e.type+" Added Successfully "," ","success")},error:function(e){var t=e.responseText;$.each(JSON.parse(t),function(e,t){var a=e+": "+t;notify("",a,"","danger")})}}),!1});var u="/api/v1/dms/categorization/metafield/",_=$("#add_new_metafield_form"),m=$("#add_new_metafield");_.submit(function(e){e.preventDefault();var t=new FormData($(this)[0]),a=_.parsley();if(a.validate(),a.isValid())return $.ajax({type:"post",url:u,data:t,processData:!1,contentType:!1,success:function(e){var t=0==e.required?"No":"Yes",a=void 0;a=0==e.data_type?"String":1==e.data_type?"Integer":2==e.data_type?"TextArea":3==e.data_type?"DropDown":4==e.data_type?"Date":5==e.data_type?"Float":"String",$(r.find("thead tr th")[0]).attr("colspan",4);var d="<td>Title</td><td>Data Type</td><td>Default Value</td><td>Required</td>";$(r.find("thead tr")[1]).html(d);var l='<tr class="clickie" data-type="meta" data-info="{self:'+e.id+'}"><td>'+e.title+"</td><td>"+a+"</td><td>"+e.default_text+"</td><td>"+t+"</td></tr>";r.find("tbody").append(l),m.modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove(),notify("Congratulations!!! ","Metafield Added Successfully "," ","success")},error:function(e){var t=e.responseText;$.each(JSON.parse(t),function(e,t){var a=e+": "+t;notify("",a,"","danger")})}}),!1}),$("#update_btn").on("click",function(){var e=$(this).data("self");"meta"==$(this).data("type")?$.ajax({url:t+"metafield/"+e,method:"GET",success:function(e){var t=0==e.required?"No":"Yes",a=void 0;a=0==e.data_type?"String":1==e.data_type?"Integer":2==e.data_type?"TextArea":3==e.data_type?"DropDown":4==e.data_type?"Date":5==e.data_type?"Float":"String";var d='<label class="control-label">Title</label><input type="text" required="" data-parsley-trigger="change" data-parsley-pattern="^[a-zA-Z0-9_. ]{2,50}$" data-parsley-error-message="Name should contain only Alphanumeric and (._) values, length should be 2-50 characters" class="form-control" name="title" value="'+e.title+'">',l='<option selected="selected" value="'+e.data_type+'">'+a+"</option>",r='<option selected="selected" value="'+e.required+'">'+t+"</option>",o='<option selected="selected" value="'+e.order+'">'+e.order+"</option>",n='<label class="control-label">Default Text</label><textarea class="form-control auto-size" name="default_text" data-parsley-trigger="change" data-parsley-pattern="^[a-zA-Z0-9_.\r ]{2,250}$" data-parsley-error-message="Value should contain only Alphanumeric and (._) values, length should be 2-250 characters">'+e.default_text+"</textarea>",s='<label class="control-label">Dropdown Value</label><textarea class="form-control auto-size" name="default_text" data-parsley-trigger="change" data-parsley-pattern="^[a-zA-Z0-9_.\r ]{2,250}$" data-parsley-error-message="Value should contain only Alphanumeric and (._) values, length should be 2-250 characters">'+e.default_text+"</textarea>",i='<label class="control-label">Default Text</label><input type="text" data-parsley-trigger="change" data-parsley-pattern="^[a-zA-Z0-9_. ]{2,50}$" data-parsley-error-message="Value should contain only Alphanumeric and (._) values, length should be 2-50 characters" class="form-control" name="default_text" value="'+e.default_text+'">',p='<label class="control-label">Put Integer Value</label><input type="text" data-parsley-trigger="change" data-parsley-type="integer" data-parsley-error-message="Value should contain only Integer value" class="form-control" name="default_text" value="'+e.default_text+'">',c='<label class="control-label">Decimal Value</label><input type="text" data-parsley-trigger="change" data-parsley-type="number" data-parsley-error-message="Value should contain only Decimal values" class="form-control" name="default_text" value="'+e.default_text+'">',u='<label class="control-label">Date</label><input type="text" class="form-control date-time-picker" id="update_date_box" name="default_text" value="'+e.default_text+'">';$("#update_meta_order").find("option[value ="+e.order+"]").remove(),$("#update_meta_order").append(o),$("#update_required").find("option[value ="+e.required+"]").remove(),$("#update_required").append(r),$("#update_data_type").find("option[value ="+e.data_type+"]").remove(),$("#update_data_type").append(l),$("#update_title").empty().append(d),0==e.data_type?$("#update_default_text").empty().append(i):1==e.data_type?$("#update_default_text").empty().append(p):2==e.data_type?$("#update_default_text").empty().append(s):3==e.data_type?$("#update_default_text").empty().append(s):4==e.data_type?$("#update_default_text").empty().append(u):5==e.data_type?$("#update_default_text").empty().append(c):$("#update_default_text").empty().append(i),$("#update_doc").css("display","none"),$("#update_metafield_modal").modal().show(),$("#update_required").selectpicker("refresh"),$("#update_data_type").selectpicker("refresh"),$("#update_meta_order").selectpicker("refresh"),$("#update_data_type").on("change",function(){0==this.value&&$("#update_default_text").empty().append(i),3==this.value&&$("#update_default_text").empty().append(s),2==this.value&&$("#update_default_text").empty().append(n),1==this.value&&$("#update_default_text").empty().append(p),4==this.value&&($("#update_default_text").empty().append(u),$("#update_date_box").datetimepicker({format:"YYYY-MM-DD",useCurrent:!1})),5==this.value&&$("#update_default_text").empty().append(c)})}}):void 0===$(this).data("parent")?$.ajax({url:t+"category/"+e,method:"GET",success:function(e){var t=void 0;t="cat"==e.type?"Category":"Document";var a=0==e.published?"Not Published":"Published",d='<option selected="selected" value="'+e.published+'">'+a+"</option>",l='<option selected="selected" value="'+e.type+'">'+t+"</option>",r='<input type="text" required="" data-parsley-trigger="change" data-parsley-pattern="^[a-zA-Z0-9_. ]{2,50}$" data-parsley-error-message="Name should contain only should contain only Alphanumeric and (._) values, length should be 2-50 characters" name="name" class="form-control fg-input" id="#name_value" value="'+e.name+'">';$("#update_parent_name").empty().append(r),$("#update_parent_cat_doc_field").find("option[value ="+e.type+"]").remove(),$("#update_parent_cat_doc_field").append(l),$("#update_parent_published_field").find("option[value ="+e.published+"]").remove(),$("#update_parent_published_field").append(d),$("#update_parent_new_cat_doc").modal().show(),$("#update_parent_cat_doc_field").selectpicker("refresh"),$("#update_parent_published_field").selectpicker("refresh")}}):"cat"==$(this).data("type")?$.ajax({url:t+"category/"+e,method:"GET",success:function(e){var t="<option value="+e.id+">"+e.name+"</option>";$("#select_parent").empty().append(t),$("#add_new_cat_doc").modal().show()}}):"doc"==$(this).data("type")?$.ajax({url:t+"category/"+e,method:"GET",success:function(e){var t="<option value="+e.id+">"+e.name+"</option>";$("#doc").empty().append(t),$("#add_new_metafield").modal().show()}}):null===$(this).data("type")&&$("#add_parent_new_cat_doc").modal().show()});var f=$("#update_parent_new_cat_doc_form"),y=$("#update_parent_new_cat_doc");f.submit(function(e){e.preventDefault();var t=$("#update_btn").data("self"),a="/api/v1/dms/categorization/category/"+t+"/",d=new FormData($(this)[0]),l=f.parsley();if(l.validate(),l.isValid())return $.ajax({type:"PATCH",url:a,data:d,processData:!1,contentType:!1,success:function(e){d.type="cat"==e.type.toLowerCase()?'<i class="zmdi zmdi-folder"></i> Category':'<i class="zmdi zmdi-file"></i> Document',d.published=0==e.published?"Not Published":"Published";var t='<tr class="clickie" data-info="{parent:'+e.parent+",self:"+e.id+'}"><td>'+e.name+"</td><td>"+d.type+"</td><td>"+d.published+"</td></tr>";r.find(".selected").empty(),r.find("tbody").append(t),y.modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove(),$("#update_btn, #delete_btn").prop("disabled",!0),notify("Congratulations!!! ",e.type+" Updated Successfully "," ","success")},error:function(e){var t=e.responseText;$.each(JSON.parse(t),function(e,t){var a=e+": "+t;notify("",a,"","danger")})}}),!1});var h=$("#update_metafield_form").parsley(),b=$("#update_metafield_form"),v=$("#update_metafield_modal");b.submit(function(e){e.preventDefault();var a=$("#update_btn").data("self"),d=t+"metafield/"+a+"/",l=new FormData($(this)[0]);if(h.validate(),h.isValid())return $.ajax({type:"PATCH",url:d,data:l,processData:!1,contentType:!1,success:function(e){var t=0==e.required?"No":"Yes",a=void 0;a=0==e.data_type?"String":1==e.data_type?"Integer":2==e.data_type?"TextArea":3==e.data_type?"DropDown":4==e.data_type?"Date":5==e.data_type?"Float":"String",$(r.find("thead tr th")[0]).attr("colspan",4);var d="<td>Title</td><td>Data Type</td><td>Default Value</td><td>Required</td>";$(r.find("thead tr")[1]).html(d);var l='<tr class="clickie" data-type="meta" data-info="{self:'+e.id+'}"><td>'+e.title+"</td><td>"+a+"</td><td>"+e.default_text+"</td><td>"+t+"</td></tr>";r.find(".selected").empty(),r.find("tbody").append(l),v.modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove(),$("#update_btn, #delete_btn").prop("disabled",!0),notify("Congratulations!!! ","Metafield updated Successfully "," ","success")},error:function(e){var t=e.responseText;$.each(JSON.parse(t),function(e,t){var a=e+": "+t;notify("",a,"","danger")})}}),!1}),$("#parent").on("change",function(){}),$(document).on("click","#delete_btn",function(){var e=$(this).data("self"),a=void 0;a="meta"==$(this).data("type")?t+"metafield/"+e:"/api/v1/dms/categorization/category/"+e,swal({title:"Are you sure?",text:"You will not be able to recover this file!",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!"}).then(function(){$.ajax({type:"DELETE",url:a,data:"csrfmiddlewaretoken="+getCookie("csrftoken"),success:function(e){swal("Deleted!","Your file has been deleted.","success"),r.find(".selected").empty(),$("#update_btn, #delete_btn").prop("disabled",!0)},error:function(e){console.log(e)}})})}),$("#add_parent_new_cat_doc_form").parsley(),$("#add_new_cat_doc_form").parsley(),$("#add_new_metafield_form").parsley()};init();